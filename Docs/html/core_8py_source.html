<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>mitgcm: core.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">mitgcm
   </div>
   <div id="projectbrief">Analysis of MITgcm output using python</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">core.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="core_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="namespacemitgcm_1_1core.html">    1</a></span>&#160;<span class="stringliteral">&quot;&quot;&quot;!</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="stringliteral">The main file with the class definitions</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="stringliteral">Core</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="stringliteral">==============</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="stringliteral">This file contains all of the classes for the module. It has the base MITgcm_Simulation class, and all of the subclasses for different types of fields. Each class has methods for taking derivatives and doing useful manipulaitons. It also has some functions that might be of use.</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keyword">import</span> numpy <span class="keyword">as</span> np</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keyword">import</span> netCDF4</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keyword">import</span> copy</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="keyword">import</span> os</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="keyword">import</span> numba</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    </div>
<div class="line"><a name="l00018"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html">   18</a></span>&#160;<span class="keyword">class </span><a class="code" href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html">MITgcm_Simulation</a>(<a class="code" href="classdict.html">dict</a>):</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!The simulation class is the main class of this package, and an instance of this class is a model object. All fields are associated with the model object - either directly (it is a dict), or indirectly through one of its subobjects (which are also dicts).</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html#aac012c75a0f5dce8bbc4b00422a12444">   22</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html#aac012c75a0f5dce8bbc4b00422a12444">__init__</a>(self,output_dir,grid_netcdf_filename,EOS_type=&#39;linear&#39;,g=9.8):</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Instantiate an MITgcm model instance.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;        </div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        os.chdir(output_dir)</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        self[<span class="stringliteral">&#39;output_dir&#39;</span>] = output_dir</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div>
<div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html#a984db65a189bf843e988079f724cdee3">   28</a></span>&#160;        self.<a class="code" href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html#a984db65a189bf843e988079f724cdee3">grid</a> = <a class="code" href="classmitgcm_1_1core_1_1_grid.html">Grid</a>(grid_netcdf_filename)</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;        </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        self[<span class="stringliteral">&#39;g&#39;</span>] = g</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;        self[<span class="stringliteral">&#39;EOS_type&#39;</span>] = EOS_type</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        <span class="keywordflow">if</span> EOS_type != <span class="stringliteral">&#39;linear&#39;</span>:</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;            <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Only linear equation of state is currently supported&#39;</span>)</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;            </div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html#a975760ba1406c74ad06af11ca3925397">   37</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html#a975760ba1406c74ad06af11ca3925397">load_field</a>(self,netcdf_filename,variable,time_level=-1,field_name=None):</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Load a model field from NetCDF output. This function associates the field with the object it is called on.</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="stringliteral">        time_level can be an integer or an array of integers. If it&#39;s an array, then multiple time levels will be returned as a higher dimensional array.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        <span class="keywordflow">if</span> field_name == <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;            field_name = variable</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        <span class="keywordflow">if</span> time_level == <span class="stringliteral">&#39;All&#39;</span>:</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <span class="keywordflow">print</span> <span class="stringliteral">&#39;Loading all available time levels in &#39;</span> + str(variable) + <span class="stringliteral">&#39;. This could take a while.&#39;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;            netcdf_file = netCDF4.Dataset(netcdf_filename)</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;            loaded_field = netcdf_file.variables[variable][...]</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;            netcdf_file.close()</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;            self[field_name] = loaded_field</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;            netcdf_file = netCDF4.Dataset(netcdf_filename)</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;            loaded_field = netcdf_file.variables[variable][time_level,...]</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;            netcdf_file.close()</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        self[field_name] = loaded_field</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <span class="keywordflow">return</span> </div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;       </div>
<div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html#ad87c2a60ef71c33a8a8bcbb7b7f8564b">   61</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html#ad87c2a60ef71c33a8a8bcbb7b7f8564b">__add__</a>(self,other):</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!A method that allows model objects to be added together. It does element wise addition for each of the fields.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        me = copy.deepcopy(self)</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        <span class="keywordflow">for</span> key, value <span class="keywordflow">in</span> me.__dict__.iteritems():</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            <span class="keywordflow">for</span> key1, value1 <span class="keywordflow">in</span> other.__dict__.iteritems():</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                <span class="keywordflow">if</span> key == key1:</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                    setattr(me, key, value + value1)</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <span class="keywordflow">return</span> me</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00070"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html#a2a8e8df1221028288883837cbf027bdb">   70</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html#a2a8e8df1221028288883837cbf027bdb">__div__</a>(self,other):</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!A method that allows model objects to be divided by floating point numbers.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        me = copy.deepcopy(self)</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="keywordflow">for</span> key, value <span class="keywordflow">in</span> me.__dict__.iteritems():</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                setattr(me, key, value/float(other))</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="keywordflow">return</span> me</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html#aa18b056e051289d148f1493f1aa75b55">   77</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html#aa18b056e051289d148f1493f1aa75b55">__mul__</a>(self, other):</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;! A method that allows model objects to be multiplied by floating point numbers.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        me = copy.deepcopy(self)</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <span class="keywordflow">for</span> key, value <span class="keywordflow">in</span> me.__dict__.iteritems():</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                setattr(me, key, value * float(other))</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="keywordflow">return</span> me</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html#a029086ad72acb8cb8c12e9d02e0092aa">   84</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html#a029086ad72acb8cb8c12e9d02e0092aa">__rmul__</a>(self, other):</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;! A method that allows model objects to be multiplied by floating point numbers.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        me = copy.deepcopy(self)</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <span class="keywordflow">for</span> key, value <span class="keywordflow">in</span> me.__dict__.iteritems():</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                setattr(me, key, value * float(other))</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <span class="keywordflow">return</span> me</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div>
<div class="line"><a name="l00091"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_upoint__field.html">   91</a></span>&#160;<span class="keyword">class </span><a class="code" href="classmitgcm_1_1core_1_1_upoint__field.html">Upoint_field</a>(<a class="code" href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html">MITgcm_Simulation</a>):</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;! This is the class for all fields on zonal velocity points.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    </div>
<div class="line"><a name="l00094"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_upoint__field.html#ab4adbcfd61c7b303b8499a5228cd6f77">   94</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_upoint__field.html#ab4adbcfd61c7b303b8499a5228cd6f77">__init__</a>(self,netcdf_filename,variable,time_level=-1,empty=False):</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordflow">if</span> empty:</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <span class="keywordflow">pass</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      self.<a class="code" href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html#a975760ba1406c74ad06af11ca3925397">load_field</a>(netcdf_filename,variable,time_level)</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="keywordflow">return</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="comment">### Derivatives of model fields    </span></div>
<div class="line"><a name="l00103"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_upoint__field.html#a40c4ea3c2527688e8419c0a276e27d5c">  103</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_upoint__field.html#a40c4ea3c2527688e8419c0a276e27d5c">take_d_dx</a>(self,model_instance,input_field = &#39;UVEL&#39;,output_field=&#39;dU_dx&#39;):</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;! Take the x derivative of the field given on u-points, using the spacings in grid object.</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="stringliteral">        Performs centred second-order differencing everywhere except next to boundaries. First order is </span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="stringliteral">        used there (meaning the gradients at the boundary are evaluated half a grid point away from where </span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="stringliteral">        they should be).&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="keywordflow">if</span> input_field <span class="keywordflow">in</span> self:</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        np.seterr(divide=<span class="stringliteral">&#39;ignore&#39;</span>)</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;            UVEL = self[input_field]</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            dU_dx = np.zeros((UVEL.shape))</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> xrange(1,UVEL.shape[2]-2):</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                dU_dx[:,:,i] = np.nan_to_num(model_instance.grid[<span class="stringliteral">&#39;wet_mask_U&#39;</span>][:,:,i]*</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                        (model_instance.grid[<span class="stringliteral">&#39;wet_mask_U&#39;</span>][:,:,i+1]*UVEL[:,:,i+1] + </div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                        (1 - model_instance.grid[<span class="stringliteral">&#39;wet_mask_U&#39;</span>][:,:,i+1])*UVEL[:,:,i] - </div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                        (1 - model_instance.grid[<span class="stringliteral">&#39;wet_mask_U&#39;</span>][:,:,i-1])*UVEL[:,:,i] - </div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                        model_instance.grid[<span class="stringliteral">&#39;wet_mask_U&#39;</span>][:,:,i-1]*UVEL[:,:,i-1])/(</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                        model_instance.grid[<span class="stringliteral">&#39;wet_mask_U&#39;</span>][:,:,i-1]*model_instance.grid[<span class="stringliteral">&#39;dxF&#39;</span>][:,i-1] + </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                        model_instance.grid[<span class="stringliteral">&#39;wet_mask_U&#39;</span>][:,:,i+1]*model_instance.grid[<span class="stringliteral">&#39;dxF&#39;</span>][:,i]))</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            i = 0</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;            dU_dx[:,:,i] = (UVEL[:,:,i+1] - UVEL[:,:,i])/(model_instance.grid[<span class="stringliteral">&#39;dxF&#39;</span>][:,i])</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            i = UVEL.shape[2]-1</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            dU_dx[:,:,i] = (UVEL[:,:,i] - UVEL[:,:,i-1])/(model_instance.grid[<span class="stringliteral">&#39;dxF&#39;</span>][:,i-1])</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            self[output_field] = dU_dx</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Chosen input array &#39;</span> + str(input_field) + <span class="stringliteral">&#39; is not defined&#39;</span>)</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        <span class="keywordflow">return</span> </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    </div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div>
<div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_upoint__field.html#acac1cef0245cd27c0975a84bef22a71d">  137</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_upoint__field.html#acac1cef0245cd27c0975a84bef22a71d">take_d_dy</a>(self,model_instance,input_field = &#39;UVEL&#39;,output_field=&#39;dU_dy&#39;):</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;! Take the y derivative of the field on u points, using the spacings provided.</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="stringliteral">        Performs centred second-order differencing everywhere except next to boundaries. First order is </span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="stringliteral">        used there (meaning the gradients at the boundary are evaluated half a grid point away from where </span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="stringliteral">        they should be).&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="keywordflow">if</span> input_field <span class="keywordflow">in</span> self:</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        np.seterr(divide=<span class="stringliteral">&#39;ignore&#39;</span>)</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            UVEL = self[input_field]</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            dU_dy = np.zeros((UVEL.shape))</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            <span class="keywordflow">for</span> j <span class="keywordflow">in</span> xrange(1,UVEL.shape[1]-1):</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                dU_dy[:,j,1:] = (model_instance.grid[<span class="stringliteral">&#39;wet_mask_U&#39;</span>][:,j,1:]*</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                                (model_instance.grid[<span class="stringliteral">&#39;wet_mask_U&#39;</span>][:,j+1,1:]*UVEL[:,j+1,1:] + </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                                (1 - model_instance.grid[<span class="stringliteral">&#39;wet_mask_U&#39;</span>][:,j+1,1:])*UVEL[:,j,1:] - </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                                <span class="comment"># if j+1 point is not fluid, use j point as the starting </span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                                <span class="comment"># location for the derivative</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                                (1 - model_instance.grid[<span class="stringliteral">&#39;wet_mask_U&#39;</span>][:,j-1,1:])*UVEL[:,j,1:] - </div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                                model_instance.grid[<span class="stringliteral">&#39;wet_mask_U&#39;</span>][:,j-1,1:]*UVEL[:,j-1,1:])/(</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                                model_instance.grid[<span class="stringliteral">&#39;wet_mask_U&#39;</span>][:,j-1,1:]*model_instance.grid[<span class="stringliteral">&#39;dyC&#39;</span>][j,:] + </div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                                model_instance.grid[<span class="stringliteral">&#39;wet_mask_U&#39;</span>][:,j+1,1:]*model_instance.grid[<span class="stringliteral">&#39;dyC&#39;</span>][j+1,:]))</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            j = 0</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            dU_dy[:,j,1:] = (model_instance.grid[<span class="stringliteral">&#39;wet_mask_U&#39;</span>][:,j,1:]*(UVEL[:,j+1,1:] -</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                UVEL[:,j,1:])/(model_instance.grid[<span class="stringliteral">&#39;dyC&#39;</span>][j+1,:]))</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            j = UVEL.shape[1]-1</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            dU_dy[:,j,1:] = (model_instance.grid[<span class="stringliteral">&#39;wet_mask_U&#39;</span>][:,j,1:]*(UVEL[:,j,1:] -</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                UVEL[:,j-1,1:])/(model_instance.grid[<span class="stringliteral">&#39;dyC&#39;</span>][j,:]))</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            self[output_field] = np.nan_to_num(dU_dy)</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Chosen input array &#39;</span> + str(input_field) + <span class="stringliteral">&#39; is not defined&#39;</span>)</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <span class="keywordflow">return</span> </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    </div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;   </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            </div>
<div class="line"><a name="l00176"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_upoint__field.html#acbc550b512401054ac04eca3dc7318af">  176</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_upoint__field.html#acbc550b512401054ac04eca3dc7318af">take_d_dz</a>(self,model_instance,input_field = &#39;UVEL&#39;,output_field=&#39;dU_dz&#39;):</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;! Take the z derivative of the field given on u-points, using the spacings in grid object.</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="stringliteral">        Performs centred second-order differencing everywhere except next to boundaries. First order is </span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="stringliteral">        used there (meaning the gradients at the boundary are evaluated half a grid point away from where </span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="stringliteral">        they should be).&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="keywordflow">if</span> input_field <span class="keywordflow">in</span> self:</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            np.seterr(divide=<span class="stringliteral">&#39;ignore&#39;</span>)</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            UVEL = self[input_field]</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            d_dz = np.zeros((UVEL.shape))</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            <span class="keywordflow">for</span> k <span class="keywordflow">in</span> xrange(1,UVEL.shape[0]-1):</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                <span class="comment"># model doesn&#39;t have overhangs, so only need this to work with fluid above and bathymetry below.</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                d_dz[k,:,:] = np.nan_to_num(model_instance.grid[<span class="stringliteral">&#39;wet_mask_U&#39;</span>][k,:,:]*(UVEL[k-1,:,:]  -</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                (1-model_instance.grid[<span class="stringliteral">&#39;wet_mask_U&#39;</span>][k+1,:,:])*UVEL[k,:,:]-</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                model_instance.grid[<span class="stringliteral">&#39;wet_mask_U&#39;</span>][k+1,:,:]*UVEL[k+1,:,:])/(model_instance.grid[<span class="stringliteral">&#39;drC&#39;</span>][k] +</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                model_instance.grid[<span class="stringliteral">&#39;wet_mask_U&#39;</span>][k+1,:,:]*model_instance.grid[<span class="stringliteral">&#39;drC&#39;</span>][k+1]))</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            k = 0</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            d_dz[k,:,:] = (UVEL[k,:,:] - UVEL[k+1,:,:])/(model_instance.grid[<span class="stringliteral">&#39;drC&#39;</span>][k+1])</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            k = UVEL.shape[0]-1</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            d_dz[k,:,:] = (UVEL[k-1,:,:] - UVEL[k,:,:])/(model_instance.grid[<span class="stringliteral">&#39;drC&#39;</span>][k])</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            self[output_field] = d_dz</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Chosen input array &#39;</span> + str(input_field) + <span class="stringliteral">&#39; is not defined&#39;</span>)</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="keywordflow">return</span> </div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div>
<div class="line"><a name="l00205"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_vpoint__field.html">  205</a></span>&#160;<span class="keyword">class </span><a class="code" href="classmitgcm_1_1core_1_1_vpoint__field.html">Vpoint_field</a>(<a class="code" href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html">MITgcm_Simulation</a>):</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;! This is the class for all fields on meridional velocity points.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div>
<div class="line"><a name="l00208"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_vpoint__field.html#a1ffd906684a51a4045b0b02092fab5ec">  208</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_vpoint__field.html#a1ffd906684a51a4045b0b02092fab5ec">__init__</a>(self,netcdf_filename,variable,time_level=-1,empty=False):</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Instantiate a field on the meridional velocity points.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="keywordflow">if</span> empty:</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            <span class="keywordflow">pass</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            self.<a class="code" href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html#a975760ba1406c74ad06af11ca3925397">load_field</a>(netcdf_filename,variable,time_level)</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="keywordflow">return</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    </div>
<div class="line"><a name="l00218"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_vpoint__field.html#a0077d0cdd01de210b130f1e684d61b6d">  218</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_vpoint__field.html#a0077d0cdd01de210b130f1e684d61b6d">take_d_dx</a>(self,model_instance,input_field = &#39;VVEL&#39;,output_field=&#39;dV_dx&#39;):</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Take the x derivative of the field on v points using the spacings in model_instance.grid object.</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="stringliteral">        This function can be daisy-chained to get higher order derivatives.</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="stringliteral">        Performs centred second-order differencing everywhere except next to boundaries. First order is </span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="stringliteral">        used there (meaning the gradients at the boundary are evaluated half a grid point away from where </span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="stringliteral">        they should be).&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <span class="keywordflow">if</span> input_field <span class="keywordflow">in</span> self:</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            np.seterr(divide=<span class="stringliteral">&#39;ignore&#39;</span>)</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            VVEL = self[input_field]</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            dV_dx = np.zeros((VVEL.shape))</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> xrange(1,VVEL.shape[2]-1):</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                dV_dx[:,1:,i] = np.nan_to_num(model_instance.grid[<span class="stringliteral">&#39;wet_mask_V&#39;</span>][:,1:,i]*</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                        (model_instance.grid[<span class="stringliteral">&#39;wet_mask_V&#39;</span>][:,1:,i+1]*VVEL[:,1:,i+1] + </div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                        (1 - model_instance.grid[<span class="stringliteral">&#39;wet_mask_V&#39;</span>][:,1:,i+1])*VVEL[:,1:,i] - </div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                        (1 - model_instance.grid[<span class="stringliteral">&#39;wet_mask_V&#39;</span>][:,1:,i-1])*VVEL[:,1:,i] - </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                        model_instance.grid[<span class="stringliteral">&#39;wet_mask_V&#39;</span>][:,1:,i-1]*VVEL[:,1:,i-1])/(</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                        model_instance.grid[<span class="stringliteral">&#39;wet_mask_V&#39;</span>][:,1:,i-1]*model_instance.grid[<span class="stringliteral">&#39;dxC&#39;</span>][:,i] + </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                        model_instance.grid[<span class="stringliteral">&#39;wet_mask_V&#39;</span>][:,1:,i+1]*model_instance.grid[<span class="stringliteral">&#39;dxC&#39;</span>][:,i+1]))</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            i = 0</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            dV_dx[:,1:,i] = (VVEL[:,1:,i+1] - VVEL[:,1:,i])/(model_instance.grid[<span class="stringliteral">&#39;dxC&#39;</span>][:,i+1])</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            i = VVEL.shape[2]-1</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            dV_dx[:,1:,i] = (VVEL[:,1:,i] - VVEL[:,1:,i-1])/(model_instance.grid[<span class="stringliteral">&#39;dxC&#39;</span>][:,i])</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            self[output_field] = dV_dx</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Chosen input array &#39;</span> + str(input_field) + <span class="stringliteral">&#39; is not defined&#39;</span>)</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <span class="keywordflow">return</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div>
<div class="line"><a name="l00250"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_vpoint__field.html#a7ffa6c1b239c78422f0224d675fd785e">  250</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_vpoint__field.html#a7ffa6c1b239c78422f0224d675fd785e">take_d_dy</a>(self,model_instance,input_field = &#39;VVEL&#39;,output_field=&#39;dV_dy&#39;):</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;! Take the y derivative of the field given on v-points, using the spacings in grid object.</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="stringliteral">        Performs centred second-order differencing everywhere except next to boundaries. First order is </span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="stringliteral">        used there (meaning the gradients at the boundary are evaluated half a grid point away from where </span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="stringliteral">        they should be).&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="keywordflow">if</span> input_field <span class="keywordflow">in</span> self:</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            np.seterr(divide=<span class="stringliteral">&#39;ignore&#39;</span>)</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            VVEL = self[input_field]</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            dV_dy = np.zeros((VVEL.shape))</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;            <span class="keywordflow">for</span> j <span class="keywordflow">in</span> xrange(1,VVEL.shape[1]-2):</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                dV_dy[:,j,:] = np.nan_to_num(model_instance.grid[<span class="stringliteral">&#39;wet_mask_V&#39;</span>][:,j,:]*(</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                        model_instance.grid[<span class="stringliteral">&#39;wet_mask_V&#39;</span>][:,j+1,:]*VVEL[:,j+1,:] + </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                        (1 - model_instance.grid[<span class="stringliteral">&#39;wet_mask_V&#39;</span>][:,j+1,:])*VVEL[:,j,:] - </div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                        (1 - model_instance.grid[<span class="stringliteral">&#39;wet_mask_V&#39;</span>][:,j-1,:])*VVEL[:,j,:] - </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                        model_instance.grid[<span class="stringliteral">&#39;wet_mask_V&#39;</span>][:,j-1,:]*VVEL[:,j-1,:])/(</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                        model_instance.grid[<span class="stringliteral">&#39;wet_mask_V&#39;</span>][:,j-1,:]*model_instance.grid[<span class="stringliteral">&#39;dyF&#39;</span>][j-1,:] + </div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                        model_instance.grid[<span class="stringliteral">&#39;wet_mask_V&#39;</span>][:,j+1,:]*model_instance.grid[<span class="stringliteral">&#39;dyF&#39;</span>][j,:]))</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            j = 0</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            dV_dy[:,j,:] = (VVEL[:,j+1,:] - VVEL[:,j,:])/(model_instance.grid[<span class="stringliteral">&#39;dyF&#39;</span>][j,:])</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            j = VVEL.shape[1]-1</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            dV_dy[:,j,:] = (VVEL[:,j,:] - VVEL[:,j-1,:])/(model_instance.grid[<span class="stringliteral">&#39;dyF&#39;</span>][j-1,:])</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            self[output_field] = dV_dy</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Chosen input array &#39;</span> + str(input_field) + <span class="stringliteral">&#39; is not defined&#39;</span>)</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <span class="keywordflow">return</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    </div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    </div>
<div class="line"><a name="l00281"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_vpoint__field.html#a9975d2dcfb23b8cca0986f7e469882fa">  281</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_vpoint__field.html#a9975d2dcfb23b8cca0986f7e469882fa">take_d_dz</a>(self,model_instance,input_field = &#39;VVEL&#39;,output_field=&#39;dV_dz&#39;):</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;! Take the z derivative of the field given on v-points, using the spacings in grid object.</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="stringliteral">        Performs centred second-order differencing everywhere except next to boundaries. First order is </span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="stringliteral">        used there (meaning the gradients at the boundary are evaluated half a grid point away from where </span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="stringliteral">        they should be).&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <span class="keywordflow">if</span> input_field <span class="keywordflow">in</span> self:</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            np.seterr(divide=<span class="stringliteral">&#39;ignore&#39;</span>)</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            VVEL = self[input_field]</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            d_dz = np.zeros((VVEL.shape))</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            <span class="keywordflow">for</span> k <span class="keywordflow">in</span> xrange(1,VVEL.shape[0]-1):</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                <span class="comment"># model doesn&#39;t have overhangs, so only need this to work with fluid above and bathymetry below.</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                d_dz[k,:,:] = np.nan_to_num(model_instance.grid[<span class="stringliteral">&#39;wet_mask_V&#39;</span>][k,:,:]*(VVEL[k-1,:,:]  -</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                    (1-model_instance.grid[<span class="stringliteral">&#39;wet_mask_V&#39;</span>][k+1,:,:])*VVEL[k,:,:]-</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                    model_instance.grid[<span class="stringliteral">&#39;wet_mask_V&#39;</span>][k+1,:,:]*VVEL[k+1,:,:])/(model_instance.grid[<span class="stringliteral">&#39;drC&#39;</span>][k] +</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                    model_instance.grid[<span class="stringliteral">&#39;wet_mask_V&#39;</span>][k+1,:,:]*model_instance.grid[<span class="stringliteral">&#39;drC&#39;</span>][k+1]))</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            k = 0</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            d_dz[k,:,:] = (VVEL[k,:,:] - VVEL[k+1,:,:])/(model_instance.grid[<span class="stringliteral">&#39;drC&#39;</span>][k+1])</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            k = VVEL.shape[0]-1</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            d_dz[k,:,:] = (VVEL[k-1,:,:] - VVEL[k,:,:])/(model_instance.grid[<span class="stringliteral">&#39;drC&#39;</span>][k])</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            self[output_field] = d_dz</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Chosen input array &#39;</span> + str(input_field) + <span class="stringliteral">&#39; is not defined&#39;</span>)</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="keywordflow">return</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    </div>
<div class="line"><a name="l00310"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_wpoint__field.html">  310</a></span>&#160;<span class="keyword">class </span><a class="code" href="classmitgcm_1_1core_1_1_wpoint__field.html">Wpoint_field</a>(<a class="code" href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html">MITgcm_Simulation</a>):</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;! This is the class for all fields on vertical velocity points.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div>
<div class="line"><a name="l00313"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_wpoint__field.html#a5149dd8a1c832999bdbcd60b4abc3b14">  313</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_wpoint__field.html#a5149dd8a1c832999bdbcd60b4abc3b14">__init__</a>(self,netcdf_filename,variable,time_level=-1,empty=False):</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="keywordflow">if</span> empty:</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            <span class="keywordflow">pass</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            self.<a class="code" href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html#a975760ba1406c74ad06af11ca3925397">load_field</a>(netcdf_filename,variable,time_level)</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <span class="keywordflow">return</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    </div>
<div class="line"><a name="l00321"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_wpoint__field.html#abc10b27c7fc6fd59b2e525485242d4c1">  321</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_wpoint__field.html#abc10b27c7fc6fd59b2e525485242d4c1">load_field</a>(self,netcdf_filename,variable,time_level=-1,field_name=None):</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;! Load a model field from NetCDF output. This function associates the field with the object it is called on.</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="stringliteral">        time_level can be an integer or an array of integers. If it&#39;s an array, then multiple time levels will be returned as a higher dimensional array.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <span class="keywordflow">if</span> field_name == <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            field_name = variable</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <span class="keywordflow">if</span> time_level == <span class="stringliteral">&#39;All&#39;</span>:</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            netcdf_file = netCDF4.Dataset(netcdf_filename)</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            loaded_field = netcdf_file.variables[variable][:,:,:]</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            netcdf_file.close()</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            self[field_name] = np.append(loaded_field,np.zeros((1,loaded_field.shape[-2],loaded_field.shape[-1])),axis=0)</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            netcdf_file = netCDF4.Dataset(netcdf_filename)</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            loaded_field = netcdf_file.variables[variable][time_level,:,:,:]</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            netcdf_file.close()</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            self[field_name] = loaded_field</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            <span class="keywordflow">if</span> hasattr(time_level, <span class="stringliteral">&#39;__len__&#39;</span>):</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                self[field_name] = np.append(loaded_field,np.zeros((len(time_level),1,loaded_field.shape[-2],loaded_field.shape[-1])),axis=1)</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                self[field_name] = np.append(loaded_field,np.zeros((1,loaded_field.shape[-2],loaded_field.shape[-1])),axis=0)</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        <span class="keywordflow">return</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    </div>
<div class="line"><a name="l00346"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_wpoint__field.html#a3dae400759f1828507a317507dbf681b">  346</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_wpoint__field.html#a3dae400759f1828507a317507dbf681b">take_d_dx</a>(self,model_instance,input_field = &#39;WVEL&#39;,output_field=&#39;dW_dx&#39;):</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Take the x derivative of the field on w points, using spacings in grid object.</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="stringliteral">        Performs centred second-order differencing everywhere except next to boundaries. First order is </span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="stringliteral">        used there (meaning the gradients at the boundary are evaluated half a grid point away from where </span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="stringliteral">        they should be).&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <span class="keywordflow">if</span> input_field <span class="keywordflow">in</span> self:</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            np.seterr(divide=<span class="stringliteral">&#39;ignore&#39;</span>)</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            WVEL = self[input_field]</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            d_dx = np.zeros((WVEL.shape))</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> xrange(1,WVEL.shape[2]-1):</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                d_dx[:,:,i] = np.nan_to_num(model_instance.grid[<span class="stringliteral">&#39;wet_mask_W&#39;</span>][:,:,i]*</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                                (model_instance.grid[<span class="stringliteral">&#39;wet_mask_W&#39;</span>][:,:,i+1]*WVEL[:,:,i+1] + </div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                                (1 - model_instance.grid[<span class="stringliteral">&#39;wet_mask_W&#39;</span>][:,:,i+1])*WVEL[:,:,i] - </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                                (1 - model_instance.grid[<span class="stringliteral">&#39;wet_mask_W&#39;</span>][:,:,i-1])*WVEL[:,:,i] - </div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                                model_instance.grid[<span class="stringliteral">&#39;wet_mask_W&#39;</span>][:,:,i-1]*WVEL[:,:,i-1])/(</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                                model_instance.grid[<span class="stringliteral">&#39;wet_mask_W&#39;</span>][:,:,i-1]*model_instance.grid[<span class="stringliteral">&#39;dxC&#39;</span>][:,i] + </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                                model_instance.grid[<span class="stringliteral">&#39;wet_mask_W&#39;</span>][:,:,i+1]*model_instance.grid[<span class="stringliteral">&#39;dxC&#39;</span>][:,i+1]))</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            i = 0</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            d_dx[:,:,i] = (WVEL[:,:,i+1] - WVEL[:,:,i])/(model_instance.grid[<span class="stringliteral">&#39;dxC&#39;</span>][:,i+1])</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            i = WVEL.shape[2]-1</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            d_dx[:,:,i] = (WVEL[:,:,i] - WVEL[:,:,i-1])/(model_instance.grid[<span class="stringliteral">&#39;dxC&#39;</span>][:,i])</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            self[output_field] = d_dx</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Chosen input array &#39;</span> + str(input_field) + <span class="stringliteral">&#39; is not defined&#39;</span>)</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        <span class="keywordflow">return</span>  </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div>
<div class="line"><a name="l00378"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_wpoint__field.html#a3874bb9811b39ed61b25de3ba3e3c39c">  378</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_wpoint__field.html#a3874bb9811b39ed61b25de3ba3e3c39c">take_d_dy</a>(self,model_instance,input_field = &#39;WVEL&#39;,output_field=&#39;dW_dy&#39;):</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Take the y derivative of the field on w points, using spacings in grid object.</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="stringliteral">        Performs centred second-order differencing everywhere except next to boundaries. First order is </span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="stringliteral">        used there (meaning the gradients at the boundary are evaluated half a grid point away from where </span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="stringliteral">        they should be).&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <span class="keywordflow">if</span> input_field <span class="keywordflow">in</span> self:</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            np.seterr(divide=<span class="stringliteral">&#39;ignore&#39;</span>)</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            WVEL = self[input_field]</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;            dW_dy = np.zeros((WVEL.shape))</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            <span class="keywordflow">for</span> j <span class="keywordflow">in</span> xrange(1,WVEL.shape[2]-1):</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                dW_dy[:,j,:] = np.nan_to_num(model_instance.grid[<span class="stringliteral">&#39;wet_mask_W&#39;</span>][:,j,:]*</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                                    (model_instance.grid[<span class="stringliteral">&#39;wet_mask_W&#39;</span>][:,j+1,:]*WVEL[:,j+1,:] + </div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                                    (1 - model_instance.grid[<span class="stringliteral">&#39;wet_mask_W&#39;</span>][:,j+1,:])*WVEL[:,j,:] - </div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                                    (1 - model_instance.grid[<span class="stringliteral">&#39;wet_mask_W&#39;</span>][:,j-1,:])*WVEL[:,j,:] - </div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                                    model_instance.grid[<span class="stringliteral">&#39;wet_mask_W&#39;</span>][:,j-1,:]*WVEL[:,j-1,:])/(</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                                    model_instance.grid[<span class="stringliteral">&#39;wet_mask_W&#39;</span>][:,j-1,:]*model_instance.grid[<span class="stringliteral">&#39;dyC&#39;</span>][j,:] + </div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                                    model_instance.grid[<span class="stringliteral">&#39;wet_mask_W&#39;</span>][:,j+1,:]*model_instance.grid[<span class="stringliteral">&#39;dyC&#39;</span>][j+1,:]))</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            j = 0</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            dW_dy[:,j,:] = (WVEL[:,j+1,:] - WVEL[:,j,:])/(model_instance.grid[<span class="stringliteral">&#39;dyC&#39;</span>][j+1,:])</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;            j = WVEL.shape[1]-1</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            dW_dy[:,j,:] = (WVEL[:,j,:] - WVEL[:,j-1,:])/(model_instance.grid[<span class="stringliteral">&#39;dyC&#39;</span>][j,:])</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            self[output_field] = dW_dy</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;       </div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Chosen input array &#39;</span> + str(input_field) + <span class="stringliteral">&#39; is not defined&#39;</span>)</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="keywordflow">return</span> </div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div>
<div class="line"><a name="l00409"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_wpoint__field.html#a3f7ffb2f1ed512712805bf78d8a8cde4">  409</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_wpoint__field.html#a3f7ffb2f1ed512712805bf78d8a8cde4">take_d_dz</a>(self,model_instance,input_field = &#39;WVEL&#39;,output_field=&#39;dW_dz&#39;):</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;! Take the z derivative of the field given on w-points, using the spacings in grid object.</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="stringliteral">        Performs centred second-order differencing everywhere except next to boundaries. First order is </span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="stringliteral">        used there (meaning the gradients at the boundary are evaluated half a grid point away from where </span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="stringliteral">        they should be).&quot;&quot;&quot;</span>  </div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        </div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        <span class="keywordflow">if</span> input_field <span class="keywordflow">in</span> self:</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;            np.seterr(divide=<span class="stringliteral">&#39;ignore&#39;</span>)</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            WVEL = self[input_field]</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            dWVEL_dz = np.zeros((WVEL.shape))</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            <span class="keywordflow">for</span> k <span class="keywordflow">in</span> xrange(1,WVEL.shape[0]-2):</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                dWVEL_dz[k,:,:] = np.nan_to_num(model_instance.grid[<span class="stringliteral">&#39;wet_mask_TH&#39;</span>][k,:,:]*(WVEL[k-1,:,:] -</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                            (1-model_instance.grid[<span class="stringliteral">&#39;wet_mask_TH&#39;</span>][k+1,:,:])*WVEL[k,:,:]-</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                            model_instance.grid[<span class="stringliteral">&#39;wet_mask_TH&#39;</span>][k+1,:,:]*WVEL[k+1,:,:])/</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                            (model_instance.grid[<span class="stringliteral">&#39;drF&#39;</span>][k-1]+</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                            model_instance.grid[<span class="stringliteral">&#39;wet_mask_TH&#39;</span>][k+1,:,:]*model_instance.grid[<span class="stringliteral">&#39;drF&#39;</span>][k]))</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;            k = 0</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            dWVEL_dz[k,:,:] = (WVEL[k,:,:] - WVEL[k+1,:,:])/(model_instance.grid[<span class="stringliteral">&#39;drF&#39;</span>][k])</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            k = WVEL.shape[0]-2</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            dWVEL_dz[k,:,:] = (WVEL[k-1,:,:] - WVEL[k,:,:])/(model_instance.grid[<span class="stringliteral">&#39;drF&#39;</span>][k-1])        </div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;            k = WVEL.shape[0]-1</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;            dWVEL_dz[k,:,:] = (WVEL[k-1,:,:] - WVEL[k,:,:])/(model_instance.grid[<span class="stringliteral">&#39;drF&#39;</span>][k-1])</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;            self[output_field] = dWVEL_dz</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;            <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Chosen input array &#39;</span> + str(input_field) + <span class="stringliteral">&#39; is not defined&#39;</span>)</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        <span class="keywordflow">return</span> </div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div>
<div class="line"><a name="l00442"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_tracerpoint__field.html">  442</a></span>&#160;<span class="keyword">class </span><a class="code" href="classmitgcm_1_1core_1_1_tracerpoint__field.html">Tracerpoint_field</a>(<a class="code" href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html">MITgcm_Simulation</a>):  </div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!This is the base class for all model fields on the tracer points. It includes definitions for taking derivatives.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00444"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_tracerpoint__field.html#a71960ccda494c5844ef01526a32bed1e">  444</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_tracerpoint__field.html#a71960ccda494c5844ef01526a32bed1e">__init__</a>(self,netcdf_filename,variable,time_level=-1,empty=False):</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <span class="keywordflow">if</span> empty:</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            <span class="keywordflow">pass</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;            self.<a class="code" href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html#a975760ba1406c74ad06af11ca3925397">load_field</a>(netcdf_filename,variable,time_level)</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        <span class="keywordflow">return</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        </div>
<div class="line"><a name="l00451"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_tracerpoint__field.html#a4e5ca6800530f2c8da4bc3d21ef4e50d">  451</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_tracerpoint__field.html#a4e5ca6800530f2c8da4bc3d21ef4e50d">take_d_dx</a>(self,model_instance,input_field = &#39;RHO&#39;,output_field=&#39;dRHO_dx&#39;):</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Take the x derivative of the field on tracer points, using spacings in grid object.</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="stringliteral">        Performs centred second-order differencing everywhere except next to boundaries. First order is </span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="stringliteral">        used there (meaning the gradients at the boundary are evaluated half a grid point away from where </span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="stringliteral">        they should be).&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <span class="keywordflow">if</span> input_field <span class="keywordflow">in</span> self:</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            np.seterr(divide=<span class="stringliteral">&#39;ignore&#39;</span>)</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            rho = self[input_field]</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;            d_dx = (self.<a class="code" href="classmitgcm_1_1core_1_1_tracerpoint__field.html#abdbf0d953baced17806d26ed4fedad12">numerics_take_d_dx</a>(rho[:],model_instance.grid[<span class="stringliteral">&#39;wet_mask_TH&#39;</span>][:],</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                                            model_instance.grid[<span class="stringliteral">&#39;dxC&#39;</span>][:],))</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            self[output_field] = np.nan_to_num(d_dx)</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Chosen input array &#39;</span> + str(input_field) + <span class="stringliteral">&#39; is not defined&#39;</span>)</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <span class="keywordflow">return</span> </div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    </div>
<div class="line"><a name="l00469"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_tracerpoint__field.html#abdbf0d953baced17806d26ed4fedad12">  469</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_tracerpoint__field.html#abdbf0d953baced17806d26ed4fedad12">numerics_take_d_dx</a>(self,rho,wet_mask_TH,dxC):</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        d_dx = np.zeros((rho.shape))</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        i = 0</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        d_dx[:,:,i] = (rho[:,:,i+1] - rho[:,:,i])/(dxC[:,i+1])</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        i = rho.shape[2]-1</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        d_dx[:,:,i] = (rho[:,:,i] - rho[:,:,i-1])/(dxC[:,i])</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> xrange(1,rho.shape[2]-1):</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;            d_dx[:,:,i] = (wet_mask_TH[:,:,i]*</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                            (wet_mask_TH[:,:,i+1]*rho[:,:,i+1] + </div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                            (1 - wet_mask_TH[:,:,i+1])*rho[:,:,i] - </div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                            (1 - wet_mask_TH[:,:,i-1])*rho[:,:,i] - </div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                            wet_mask_TH[:,:,i-1]*rho[:,:,i-1])/(</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                            wet_mask_TH[:,:,i-1]*dxC[:,i] + </div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                            wet_mask_TH[:,:,i+1]*dxC[:,i+1]))</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        <span class="keywordflow">return</span> d_dx</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div>
<div class="line"><a name="l00489"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_tracerpoint__field.html#a5292f8f5c2110f476329806bee9315bf">  489</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_tracerpoint__field.html#a5292f8f5c2110f476329806bee9315bf">take_d_dy</a>(self,model_instance,input_field = &#39;RHO&#39;,output_field=&#39;dRHO_dy&#39;):</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Take the y derivative of the field on tracer points, using spacings in grid object.</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="stringliteral">        Performs centred second-order differencing everywhere except next to boundaries. First order is </span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="stringliteral">        used there (meaning the gradients at the boundary are evaluated half a grid point away from where </span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="stringliteral">        they should be).&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <span class="keywordflow">if</span> input_field <span class="keywordflow">in</span> self:</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        <span class="comment">#np.seterr(divide=&#39;ignore&#39;)</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;            self[output_field] = np.nan_to_num(self.<a class="code" href="classmitgcm_1_1core_1_1_tracerpoint__field.html#aa7104af7db145561e258c97c96c1be1b">numerics_take_d_dy</a>(self[input_field][:],model_instance.grid[<span class="stringliteral">&#39;wet_mask_TH&#39;</span>][:],</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                                                 model_instance.grid[<span class="stringliteral">&#39;dyC&#39;</span>][:]))</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;            <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Chosen input array &#39;</span> + str(input_field) + <span class="stringliteral">&#39; is not defined&#39;</span>)</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        <span class="keywordflow">return</span>  </div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        </div>
<div class="line"><a name="l00505"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_tracerpoint__field.html#aa7104af7db145561e258c97c96c1be1b">  505</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_tracerpoint__field.html#aa7104af7db145561e258c97c96c1be1b">numerics_take_d_dy</a>(self,rho,wet_mask_TH,dyC):</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!The numerical bit of taking the y derivative. This has been separated out so that it can be accelerated with numba, but that isn&#39;t working yet.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        d_dy = np.zeros((rho.shape))</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;            </div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        j = 0</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        d_dy[:,j,:] = (rho[:,j+1,:] - rho[:,j,:])/(dyC[j+1,:])</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        j = rho.shape[1]-1</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        d_dy[:,j,:] = (rho[:,j,:] - rho[:,j-1,:])/(dyC[j,:])</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        <span class="keywordflow">for</span> j <span class="keywordflow">in</span> xrange(1,rho.shape[1]-1):</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;           d_dy[:,j,:] = (wet_mask_TH[:,j,:]*</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                            (wet_mask_TH[:,j+1,:]*rho[:,j+1,:] + </div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                            (1 - wet_mask_TH[:,j+1,:])*rho[:,j,:] - </div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                            (1 - wet_mask_TH[:,j-1,:])*rho[:,j,:] - </div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                            wet_mask_TH[:,j-1,:]*rho[:,j-1,:])/(</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                            wet_mask_TH[:,j-1,:]*dyC[j,:] + </div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                            wet_mask_TH[:,j+1,:]*dyC[j+1,:]))</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        <span class="keywordflow">return</span> d_dy</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    </div>
<div class="line"><a name="l00526"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_tracerpoint__field.html#aa54bc7f1fe31f946b3ed13cc1c66f22e">  526</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_tracerpoint__field.html#aa54bc7f1fe31f946b3ed13cc1c66f22e">take_d_dz</a>(self,model_instance,input_field = &#39;RHO&#39;,output_field=&#39;dRHO_dz&#39;):</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;! Take the z derivative of the field given on tracer-points, using the spacings in grid object.</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="stringliteral">        Performs centred second-order differencing everywhere except next to boundaries. First order is </span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="stringliteral">        used there (meaning the gradients at the boundary are evaluated half a grid point away from where </span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="stringliteral">        they should be).&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        <span class="keywordflow">if</span> input_field <span class="keywordflow">in</span> self:</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            np.seterr(divide=<span class="stringliteral">&#39;ignore&#39;</span>)</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            rho = self[input_field]</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            d_dz = np.zeros((rho.shape))</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;            <span class="keywordflow">for</span> k <span class="keywordflow">in</span> xrange(1,rho.shape[0]-1):</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                <span class="comment"># model doesn&#39;t have overhangs, so only need this to work with fluid above and bathymetry below.</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                d_dz[k,:,:] = (model_instance.grid[<span class="stringliteral">&#39;wet_mask_TH&#39;</span>][k,:,:]*(rho[k-1,:,:]  -</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                                    (1-model_instance.grid[<span class="stringliteral">&#39;wet_mask_TH&#39;</span>][k+1,:,:])*rho[k,:,:]-</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                                    model_instance.grid[<span class="stringliteral">&#39;wet_mask_TH&#39;</span>][k+1,:,:]*rho[k+1,:,:])/(model_instance.grid[<span class="stringliteral">&#39;drC&#39;</span>][k] +</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                                    model_instance.grid[<span class="stringliteral">&#39;wet_mask_TH&#39;</span>][k+1,:,:]*model_instance.grid[<span class="stringliteral">&#39;drC&#39;</span>][k+1]))</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            k = 0</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            d_dz[k,:,:] = (rho[k,:,:] - rho[k+1,:,:])/(model_instance.grid[<span class="stringliteral">&#39;drC&#39;</span>][k+1])</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;            k = rho.shape[0]-1</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;            d_dz[k,:,:] = (rho[k-1,:,:] - rho[k,:,:])/(model_instance.grid[<span class="stringliteral">&#39;drC&#39;</span>][k])</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;            self[output_field] = np.nan_to_num(d_dz)</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;            <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Chosen input array &#39;</span> + str(input_field) + <span class="stringliteral">&#39; is not defined&#39;</span>)</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <span class="keywordflow">return</span> </div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    </div>
<div class="line"><a name="l00557"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_vorticitypoint__field.html">  557</a></span>&#160;<span class="keyword">class </span><a class="code" href="classmitgcm_1_1core_1_1_vorticitypoint__field.html">Vorticitypoint_field</a>(<a class="code" href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html">MITgcm_Simulation</a>):  </div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!A class for fields on vorticity points.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00559"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_vorticitypoint__field.html#ad66ee0e21b3b64b6263d322c7d28a0d1">  559</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_vorticitypoint__field.html#ad66ee0e21b3b64b6263d322c7d28a0d1">__init__</a>(self,netcdf_filename,variable,time_level=-1,empty=False):</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        <span class="keywordflow">if</span> empty:</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;            <span class="keywordflow">pass</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;            self.<a class="code" href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html#a975760ba1406c74ad06af11ca3925397">load_field</a>(netcdf_filename,variable,time_level)</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        <span class="keywordflow">return</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        </div>
<div class="line"><a name="l00568"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_vorticitypoint__field.html#ab7dd01f831fe81a7ce431625d54aa11f">  568</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_vorticitypoint__field.html#ab7dd01f831fe81a7ce431625d54aa11f">take_d_dx</a>(self,model_instance,input_field = &#39;momVort3&#39;,output_field=&#39;dmomVort3_dx&#39;):</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;! Take the x derivative of the field given on vorticity-points, using the spacings in grid object.</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="stringliteral">        Performs centred second-order differencing everywhere except next to boundaries. First order is </span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="stringliteral">        used there (meaning the gradients at the boundary are evaluated half a grid point away from where </span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="stringliteral">        they should be).&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        <span class="keywordflow">if</span> input_field <span class="keywordflow">in</span> self:</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            np.seterr(divide=<span class="stringliteral">&#39;ignore&#39;</span>)</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            momVort3 = self[input_field]</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;            dmomVort3_dx = np.zeros((momVort3.shape))</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> xrange(1,momVort3.shape[2]-2):</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                dmomVort3_dx[:,:,i] = np.nan_to_num(model_instance.grid[<span class="stringliteral">&#39;wet_mask_U&#39;</span>][:,:,i]*</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                        (model_instance.grid[<span class="stringliteral">&#39;wet_mask_U&#39;</span>][:,:,i+1]*momVort3[:,:,i+1] + </div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                        (1 - model_instance.grid[<span class="stringliteral">&#39;wet_mask_U&#39;</span>][:,:,i+1])*momVort3[:,:,i] - </div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                        (1 - model_instance.grid[<span class="stringliteral">&#39;wet_mask_U&#39;</span>][:,:,i-1])*momVort3[:,:,i] - </div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                        model_instance.grid[<span class="stringliteral">&#39;wet_mask_U&#39;</span>][:,:,i-1]*momVort3[:,:,i-1])/(</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                        model_instance.grid[<span class="stringliteral">&#39;wet_mask_U&#39;</span>][:,:,i-1]*model_instance.grid[<span class="stringliteral">&#39;dxF&#39;</span>][:,i-1] + </div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                        model_instance.grid[<span class="stringliteral">&#39;wet_mask_U&#39;</span>][:,:,i+1]*model_instance.grid[<span class="stringliteral">&#39;dxF&#39;</span>][:,i]))</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;            i = 0</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            dmomVort3_dx[:,:,i] = (momVort3[:,:,i+1] - momVort3[:,:,i])/(model_instance.grid[<span class="stringliteral">&#39;dxF&#39;</span>][:,i])</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;            i = momVort3.shape[2]-1</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;            dmomVort3_dx[:,:,i] = (momVort3[:,:,i] - momVort3[:,:,i-1])/(model_instance.grid[<span class="stringliteral">&#39;dxF&#39;</span>][:,i-1])</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;            self[output_field] = dmomVort3_dx</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;            <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Chosen input array &#39;</span> + str(input_field) + <span class="stringliteral">&#39; is not defined&#39;</span>)</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;            </div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        <span class="keywordflow">return</span> </div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;</div>
<div class="line"><a name="l00599"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_vorticitypoint__field.html#a1ac62e67431f0edfedfec642f3f5d3f3">  599</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_vorticitypoint__field.html#a1ac62e67431f0edfedfec642f3f5d3f3">take_d_dy</a>(self,model_instance,input_field = &#39;momVort3&#39;,output_field=&#39;dmomVort3_dy&#39;):</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;! Take the y derivative of the field given on vorticity-points, using the spacings in grid object.</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="stringliteral">        Performs centred second-order differencing everywhere except next to boundaries. First order is </span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="stringliteral">        used there (meaning the gradients at the boundary are evaluated half a grid point away from where </span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="stringliteral">        they should be).&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <span class="keywordflow">if</span> input_field <span class="keywordflow">in</span> self:</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;            np.seterr(divide=<span class="stringliteral">&#39;ignore&#39;</span>)</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            momVort3 = self[input_field]</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;            dmomVort3_dy = np.zeros((momVort3.shape))</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            <span class="keywordflow">for</span> j <span class="keywordflow">in</span> xrange(1,momVort3.shape[1]-2):</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                dmomVort3_dy[:,j,:] = np.nan_to_num(model_instance.grid[<span class="stringliteral">&#39;wet_mask_V&#39;</span>][:,j,:]*(</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                        model_instance.grid[<span class="stringliteral">&#39;wet_mask_V&#39;</span>][:,j+1,:]*momVort3[:,j+1,:] + </div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                        (1 - model_instance.grid[<span class="stringliteral">&#39;wet_mask_V&#39;</span>][:,j+1,:])*momVort3[:,j,:] - </div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                        (1 - model_instance.grid[<span class="stringliteral">&#39;wet_mask_V&#39;</span>][:,j-1,:])*momVort3[:,j,:] - </div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                        model_instance.grid[<span class="stringliteral">&#39;wet_mask_V&#39;</span>][:,j-1,:]*momVort3[:,j-1,:])/(</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                        model_instance.grid[<span class="stringliteral">&#39;wet_mask_V&#39;</span>][:,j-1,:]*model_instance.grid[<span class="stringliteral">&#39;dyF&#39;</span>][j-1,:] + </div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                        model_instance.grid[<span class="stringliteral">&#39;wet_mask_V&#39;</span>][:,j+1,:]*model_instance.grid[<span class="stringliteral">&#39;dyF&#39;</span>][j,:]))</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;            j = 0</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;            dmomVort3_dy[:,j,:] = (momVort3[:,j+1,:] - momVort3[:,j,:])/(model_instance.grid[<span class="stringliteral">&#39;dyF&#39;</span>][j,:])</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            j = momVort3.shape[1]-1</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            dmomVort3_dy[:,j,:] = (momVort3[:,j,:] - momVort3[:,j-1,:])/(model_instance.grid[<span class="stringliteral">&#39;dyF&#39;</span>][j-1,:])</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            self[output_field] = dmomVort3_dy</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;            <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Chosen input array &#39;</span> + str(input_field) + <span class="stringliteral">&#39; is not defined&#39;</span>)</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        <span class="keywordflow">return</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div>
<div class="line"><a name="l00629"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_vorticitypoint__field.html#a2819c9078fdedaea17990850de8659fb">  629</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_vorticitypoint__field.html#a2819c9078fdedaea17990850de8659fb">take_d_dz</a>(self,model_instance,input_field = &#39;momVort3&#39;,output_field=&#39;dmomVort3_dz&#39;):</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;! Take the z derivative of the field given on vorticity-points, using the spacings in grid object.</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="stringliteral">        Performs centred second-order differencing everywhere except next to boundaries. First order is </span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="stringliteral">        used there (meaning the gradients at the boundary are evaluated half a grid point away from where </span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="stringliteral">        they should be).&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        <span class="keywordflow">if</span> input_field <span class="keywordflow">in</span> self:</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;            np.seterr(divide=<span class="stringliteral">&#39;ignore&#39;</span>)</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            momVort3 = self[input_field]</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;            d_dz = np.zeros((momVort3.shape))</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;            <span class="keywordflow">for</span> k <span class="keywordflow">in</span> xrange(1,momVort3.shape[0]-1):</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;            <span class="comment"># model doesn&#39;t have overhangs, so only need this to work with fluid above and bathymetry below.</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                d_dz[k,:,:] = np.nan_to_num(model_instance.grid[<span class="stringliteral">&#39;wet_mask_TH&#39;</span>][k,:,:]*(momVort3[k-1,:,:]  -</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                    (1-model_instance.grid[<span class="stringliteral">&#39;wet_mask_TH&#39;</span>][k+1,:,:])*momVort3[k,:,:]-</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                    model_instance.grid[<span class="stringliteral">&#39;wet_mask_TH&#39;</span>][k+1,:,:]*momVort3[k+1,:,:])/(model_instance.grid[<span class="stringliteral">&#39;drC&#39;</span>][k] +</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                    model_instance.grid[<span class="stringliteral">&#39;wet_mask_TH&#39;</span>][k+1,:,:]*model_instance.grid[<span class="stringliteral">&#39;drC&#39;</span>][k+1]))</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;            k = 0</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;            d_dz[k,:,:] = (momVort3[k,:,:] - momVort3[k+1,:,:])/(model_instance.grid[<span class="stringliteral">&#39;drC&#39;</span>][k+1])</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;            k = momVort3.shape[0]-1</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;            d_dz[k,:,:] = (momVort3[k-1,:,:] - momVort3[k,:,:])/(model_instance.grid[<span class="stringliteral">&#39;drC&#39;</span>][k])</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;            self[output_field] = d_dz</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;            <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Chosen input array &#39;</span> + str(input_field) + <span class="stringliteral">&#39; is not defined&#39;</span>)</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        <span class="keywordflow">return</span> </div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div>
<div class="line"><a name="l00659"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_grid.html">  659</a></span>&#160;<span class="keyword">class </span><a class="code" href="classmitgcm_1_1core_1_1_grid.html">Grid</a>(<a class="code" href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html">MITgcm_Simulation</a>):</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!This defines the class for the grid object. </span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="stringliteral">    This object holds all the information about the grid on which the simulation was run. It also holds masks for selecting only the boundary values of fields on the tracer points. </span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;</div>
<div class="line"><a name="l00665"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_grid.html#a79af97fd15b63db33ac352236168d38b">  665</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_grid.html#a79af97fd15b63db33ac352236168d38b">__init__</a>(self, grid_netcdf_filename):</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Define a single object that has all of the grid variables tucked away in it. </span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="stringliteral">        Each of the variables pulled directly from the netcdf file still has the </span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="stringliteral">        original description attached to it. The 2D and 3D arrays do not.</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="stringliteral">        Variables imported are:</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="stringliteral">        * rAw</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="stringliteral">        * rAs</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="stringliteral">        * rA</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="stringliteral">        * HFacW</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="stringliteral">        * HFacS</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="stringliteral">        * HFacC</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="stringliteral">        * X</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="stringliteral">        * Xp1</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="stringliteral">        * dxF</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="stringliteral">        * dxC</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="stringliteral">        * dxV</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="stringliteral">        * Y</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="stringliteral">        * Yp1</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="stringliteral">        * dyU</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="stringliteral">        * dyC</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="stringliteral">        * dyF</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="stringliteral">        * Z</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="stringliteral">        * Zl</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="stringliteral">        * Zu</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="stringliteral">        * drC</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="stringliteral">        * drF</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="stringliteral">        * fCoriG</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="stringliteral">        * fCori</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="stringliteral">        Variables computed and stored are:</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="stringliteral">        * (Z_y,Y_z)</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;<span class="stringliteral">        * (X_y,Y_x)</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="stringliteral">        * (Z_x,X_z) </span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="stringliteral">        * (Z_3d,Y_3d,X_3d) </span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="stringliteral">        * (DZF,DYF, DXF): a 3d array of dxF,dyF adn dzF </span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="stringliteral">        * wet_mask_V : a 3d array that is one if the point is in the fluid, zero otherwise.</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="stringliteral">        * wet_mask_U </span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="stringliteral">        * wet_mask_TH </span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="stringliteral">        * wet_mask_W </span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="stringliteral">        * cell_volume</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="stringliteral">        * west_mask : a 3d array that is one if the point has a boundary to the west</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;<span class="stringliteral">        * east_mask</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="stringliteral">        * south_mask</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="stringliteral">        * north_mask</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="stringliteral">        * bottom_mask</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        grid_netcdf_file = netCDF4.Dataset(grid_netcdf_filename)</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        self[<span class="stringliteral">&#39;rAw&#39;</span>] = grid_netcdf_file.variables[<span class="stringliteral">&#39;rAw&#39;</span>]</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        self[<span class="stringliteral">&#39;rAs&#39;</span>] = grid_netcdf_file.variables[<span class="stringliteral">&#39;rAs&#39;</span>]</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        self[<span class="stringliteral">&#39;rA&#39;</span>] = grid_netcdf_file.variables[<span class="stringliteral">&#39;rA&#39;</span>]</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        self[<span class="stringliteral">&#39;HFacW&#39;</span>] = grid_netcdf_file.variables[<span class="stringliteral">&#39;HFacW&#39;</span>]</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        self[<span class="stringliteral">&#39;HFacS&#39;</span>] = grid_netcdf_file.variables[<span class="stringliteral">&#39;HFacS&#39;</span>]</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        self[<span class="stringliteral">&#39;HFacC&#39;</span>] = grid_netcdf_file.variables[<span class="stringliteral">&#39;HFacC&#39;</span>]</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        self[<span class="stringliteral">&#39;X&#39;</span>]= grid_netcdf_file.variables[<span class="stringliteral">&#39;X&#39;</span>]</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        self[<span class="stringliteral">&#39;Xp1&#39;</span>] = grid_netcdf_file.variables[<span class="stringliteral">&#39;Xp1&#39;</span>]</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        self[<span class="stringliteral">&#39;dxF&#39;</span>] = grid_netcdf_file.variables[<span class="stringliteral">&#39;dxF&#39;</span>]</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        self[<span class="stringliteral">&#39;dxC&#39;</span>] = grid_netcdf_file.variables[<span class="stringliteral">&#39;dxC&#39;</span>]</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        self[<span class="stringliteral">&#39;dxV&#39;</span>] = grid_netcdf_file.variables[<span class="stringliteral">&#39;dxV&#39;</span>]</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        self[<span class="stringliteral">&#39;Y&#39;</span>] = grid_netcdf_file.variables[<span class="stringliteral">&#39;Y&#39;</span>]</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        self[<span class="stringliteral">&#39;Yp1&#39;</span>] = grid_netcdf_file.variables[<span class="stringliteral">&#39;Yp1&#39;</span>]</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        self[<span class="stringliteral">&#39;dyU&#39;</span>] = grid_netcdf_file.variables[<span class="stringliteral">&#39;dyU&#39;</span>]</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        self[<span class="stringliteral">&#39;dyC&#39;</span>] = grid_netcdf_file.variables[<span class="stringliteral">&#39;dyC&#39;</span>]</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        self[<span class="stringliteral">&#39;dyF&#39;</span>] = grid_netcdf_file.variables[<span class="stringliteral">&#39;dyF&#39;</span>]</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        self[<span class="stringliteral">&#39;Z&#39;</span>] = grid_netcdf_file.variables[<span class="stringliteral">&#39;Z&#39;</span>]</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        self[<span class="stringliteral">&#39;Zl&#39;</span>] = grid_netcdf_file.variables[<span class="stringliteral">&#39;Zl&#39;</span>]</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        self[<span class="stringliteral">&#39;Zu&#39;</span>] = grid_netcdf_file.variables[<span class="stringliteral">&#39;Zu&#39;</span>]</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        self[<span class="stringliteral">&#39;drC&#39;</span>] = grid_netcdf_file.variables[<span class="stringliteral">&#39;drC&#39;</span>]</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        self[<span class="stringliteral">&#39;drF&#39;</span>] = grid_netcdf_file.variables[<span class="stringliteral">&#39;drF&#39;</span>]</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        self[<span class="stringliteral">&#39;fCoriG&#39;</span>] = grid_netcdf_file.variables[<span class="stringliteral">&#39;fCoriG&#39;</span>]</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        self[<span class="stringliteral">&#39;fCori&#39;</span>] = grid_netcdf_file.variables[<span class="stringliteral">&#39;fCori&#39;</span>]</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        (self[<span class="stringliteral">&#39;Z_y&#39;</span>],self[<span class="stringliteral">&#39;Y_z&#39;</span>]) = np.meshgrid(self[<span class="stringliteral">&#39;Z&#39;</span>][:],self[<span class="stringliteral">&#39;Y&#39;</span>][:],indexing=<span class="stringliteral">&#39;ij&#39;</span>)</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        (self[<span class="stringliteral">&#39;X_y&#39;</span>],self[<span class="stringliteral">&#39;Y_x&#39;</span>]) = np.meshgrid(self[<span class="stringliteral">&#39;X&#39;</span>],self[<span class="stringliteral">&#39;Y&#39;</span>][:],indexing=<span class="stringliteral">&#39;ij&#39;</span>)</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        (self[<span class="stringliteral">&#39;Z_x&#39;</span>],self[<span class="stringliteral">&#39;X_z&#39;</span>]) = np.meshgrid(self[<span class="stringliteral">&#39;Z&#39;</span>],self[<span class="stringliteral">&#39;X&#39;</span>][:],indexing=<span class="stringliteral">&#39;ij&#39;</span>)</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        (self[<span class="stringliteral">&#39;Z_3d&#39;</span>],self[<span class="stringliteral">&#39;Y_3d&#39;</span>],self[<span class="stringliteral">&#39;X_3d&#39;</span>]) = np.meshgrid(self[<span class="stringliteral">&#39;Z&#39;</span>][:],self[<span class="stringliteral">&#39;Y&#39;</span>][:],self[<span class="stringliteral">&#39;X&#39;</span>][:],indexing=<span class="stringliteral">&#39;ij&#39;</span>)</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        (self[<span class="stringliteral">&#39;DZF&#39;</span>],self[<span class="stringliteral">&#39;DYF&#39;</span>], self[<span class="stringliteral">&#39;DXF&#39;</span>]) = np.meshgrid(self[<span class="stringliteral">&#39;drF&#39;</span>][:],self[<span class="stringliteral">&#39;dyF&#39;</span>][0,:],self[<span class="stringliteral">&#39;dxF&#39;</span>][:,0],indexing=<span class="stringliteral">&#39;ij&#39;</span>)</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        self[<span class="stringliteral">&#39;wet_mask_V&#39;</span>] = np.ones((np.shape(self[<span class="stringliteral">&#39;HFacS&#39;</span>][:])))</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        self[<span class="stringliteral">&#39;wet_mask_V&#39;</span>][self[<span class="stringliteral">&#39;HFacS&#39;</span>][:] == 0.] = 0.</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        self[<span class="stringliteral">&#39;wet_mask_U&#39;</span>] = np.ones((np.shape(self[<span class="stringliteral">&#39;HFacW&#39;</span>][:])))</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        self[<span class="stringliteral">&#39;wet_mask_U&#39;</span>][self[<span class="stringliteral">&#39;HFacW&#39;</span>][:] == 0.] = 0.</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        self[<span class="stringliteral">&#39;wet_mask_TH&#39;</span>] = np.ones((np.shape(self[<span class="stringliteral">&#39;HFacC&#39;</span>][:])))</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        self[<span class="stringliteral">&#39;wet_mask_TH&#39;</span>][self[<span class="stringliteral">&#39;HFacC&#39;</span>][:] == 0.] = 0.</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        self[<span class="stringliteral">&#39;wet_mask_W&#39;</span>] = np.append(self[<span class="stringliteral">&#39;wet_mask_TH&#39;</span>],np.ones((1,len(self[<span class="stringliteral">&#39;Y&#39;</span>][:]),len(self[<span class="stringliteral">&#39;X&#39;</span>][:]))),axis=0)</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        self[<span class="stringliteral">&#39;cell_volume&#39;</span>] = copy.deepcopy(self[<span class="stringliteral">&#39;dxF&#39;</span>][:]*self[<span class="stringliteral">&#39;dyF&#39;</span>][:]*</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                                    self[<span class="stringliteral">&#39;drF&#39;</span>][:].reshape((len(self[<span class="stringliteral">&#39;drF&#39;</span>][:]),1,1)))</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        self.<a class="code" href="classmitgcm_1_1core_1_1_grid.html#ad33f3e78699330079c7ae7dfbd5d7adb">compute_masks</a>(self[<span class="stringliteral">&#39;wet_mask_TH&#39;</span>][:])</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;                        </div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        <span class="keywordflow">return</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        </div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    @numba.jit        </div>
<div class="line"><a name="l00765"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_grid.html#ad33f3e78699330079c7ae7dfbd5d7adb">  765</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_grid.html#ad33f3e78699330079c7ae7dfbd5d7adb">compute_masks</a>(self,wet_mask_TH):</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!This function does the compuationally heavy job of looping through each dimension and creating masks that are one if the boundary is next to the grid point in the specified direction. This function is accelerated by numba, making it about 100 times faster.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        west_mask = np.zeros((wet_mask_TH.shape))</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        east_mask = np.zeros((wet_mask_TH.shape))</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        south_mask = np.zeros((wet_mask_TH.shape))</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        north_mask = np.zeros((wet_mask_TH.shape))</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        bottom_mask = np.zeros((wet_mask_TH.shape))</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        </div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        <span class="comment"># Find the fluxes through the boundary of the domain</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        <span class="keywordflow">for</span> k <span class="keywordflow">in</span> xrange(0,wet_mask_TH.shape[0]):</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;            <span class="keywordflow">for</span> j <span class="keywordflow">in</span> xrange(0,wet_mask_TH.shape[1]):</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;                <span class="keywordflow">for</span> i <span class="keywordflow">in</span> xrange(0,wet_mask_TH.shape[2]):</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;                    <span class="comment"># find points with boundary to the west. In the simplest shelf configuration this is the only tricky boundary to find.</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                    <span class="keywordflow">if</span> wet_mask_TH[k,j,i] - wet_mask_TH[k,j,i-1] == 1:</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;                        west_mask[k,j,i] = 1</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                    <span class="comment"># find the eastern boundary points. Negative sign is to be consistent about fluxes into the domain.</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;                    <span class="keywordflow">if</span> wet_mask_TH[k,j,i-1] - wet_mask_TH[k,j,i] == 1:</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                        east_mask[k,j,i-1] = 1</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;                    <span class="comment"># find the southern boundary points</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                    <span class="keywordflow">if</span> wet_mask_TH[k,j,i] - wet_mask_TH[k,j-1,i] == 1:</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                        south_mask[k,j,i] = 1</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;                    <span class="comment"># find the northern boundary points</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                    <span class="keywordflow">if</span> wet_mask_TH[k,j-1,i] - wet_mask_TH[k,j,i] == 1:</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;                        north_mask[k,j,i-1] = 1</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;                    <span class="comment"># Fluxes through the bottom</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;                    <span class="keywordflow">if</span> wet_mask_TH[k-1,j,i] - wet_mask_TH[k,j,i] == 1:</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                        bottom_mask[k-1,j,i] = 1</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        </div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        self[<span class="stringliteral">&#39;west_mask&#39;</span>] = west_mask</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        self[<span class="stringliteral">&#39;east_mask&#39;</span>] = east_mask</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        self[<span class="stringliteral">&#39;south_mask&#39;</span>] = south_mask</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        self[<span class="stringliteral">&#39;north_mask&#39;</span>] = north_mask</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        self[<span class="stringliteral">&#39;bottom_mask&#39;</span>] = bottom_mask</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;        <span class="keywordflow">return</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        </div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        </div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div>
<div class="line"><a name="l00810"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_density.html">  810</a></span>&#160;<span class="keyword">class </span><a class="code" href="classmitgcm_1_1core_1_1_density.html">Density</a>(<a class="code" href="classmitgcm_1_1core_1_1_tracerpoint__field.html">Tracerpoint_field</a>):</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!A tracer point field that contains methods for density fields. Only linear equation of state with temperature variations is supported at the moment.</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="stringliteral">    The linear equation of state is given by</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;<span class="stringliteral">    \f[</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;<span class="stringliteral">    \rho = \rho_{nil} (-\alpha_{T} (\theta - \theta_{0}) + \beta_{S} (S - S_{0})) + \rho_{nil}</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;<span class="stringliteral">    \f]</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="stringliteral">    where \f$ \rho_{nil} \f$ is the reference density, \f$ \alpha_{T} \f$ is the thermal expansion coefficient, \f$ \beta_{S} \f$ is the haline contraction coefficient, \f$ \theta \f$ and \f$ \beta \f$ are the temperature and salinity fields, and subscript zeros denote reference values.</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_density.html#ac4f90f6a9c4a9fe9608b5bfdcb09a47c">__init__</a>(self,model_instance,Talpha=2e-4,Sbeta=0,RhoNil=1035,cp=4000,</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                    temp_field=<span class="stringliteral">&#39;THETA&#39;</span>,salt_field=<span class="stringliteral">&#39;S&#39;</span>,density_field=<span class="stringliteral">&#39;RHO&#39;</span>,</div>
<div class="line"><a name="l00823"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_density.html#ac4f90f6a9c4a9fe9608b5bfdcb09a47c">  823</a></span>&#160;                    Tref=20,Sref=30,empty=<span class="keyword">False</span>):</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        <span class="keywordflow">if</span> empty:</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;            <span class="keywordflow">pass</span></div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;            self[<span class="stringliteral">&#39;cp&#39;</span>] = cp</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;            self[<span class="stringliteral">&#39;Talpha&#39;</span>] = Talpha</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;            self[<span class="stringliteral">&#39;Sbeta&#39;</span>] = Sbeta</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;            self[<span class="stringliteral">&#39;RhoNil&#39;</span>] = RhoNil</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;            self.<a class="code" href="classmitgcm_1_1core_1_1_density.html#a2218bb1f82fd92d2d828bc30a87b69f3">calculate_density</a>(model_instance,Talpha,Sbeta,RhoNil,cp,</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;                                    temp_field,salt_field,density_field,Tref,Sref)</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_density.html#a2218bb1f82fd92d2d828bc30a87b69f3">calculate_density</a>(self,model_instance,Talpha=2e-4,Sbeta=0,RhoNil=1035,cp=4000,</div>
<div class="line"><a name="l00836"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_density.html#a2218bb1f82fd92d2d828bc30a87b69f3">  836</a></span>&#160;          temp_field=<span class="stringliteral">&#39;THETA&#39;</span>,salt_field=<span class="stringliteral">&#39;S&#39;</span>,density_field=<span class="stringliteral">&#39;RHO&#39;</span>,Tref=20,Sref=30):</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Cacluate Density field given temperature and salinity fields, using the linear equation of state.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;        <span class="keywordflow">if</span> model_instance[<span class="stringliteral">&#39;EOS_type&#39;</span>] == <span class="stringliteral">&#39;linear&#39;</span>:</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;            <span class="keywordflow">if</span> Sbeta == 0:</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;                self[density_field] = (RhoNil*( -Talpha*(model_instance.temperature[temp_field] - Tref)) </div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;                + RhoNil)</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;                self[density_field] = (RhoNil*( Sbeta*(model_instance.salinity[salt_field] - Sref) - Talpha*(model_instance.temperature[temp_field] - Tref)) </div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;                + RhoNil)</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;                <span class="keywordflow">print</span> <span class="stringliteral">&#39;Warning: Linear equation of state with salinity is currently untested. Proceed with caution.&#39;</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;          <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Only linear EOS supported at the moment. Sorry.&#39;</span>)</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;</div>
<div class="line"><a name="l00849"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_density.html#ace1f408672554eb3871856cb8934aaa0">  849</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_density.html#ace1f408672554eb3871856cb8934aaa0">calculate_TotRhoTend</a>(self,model_instance):</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Calculate time rate of change of the Density field from the temperature tendency and the linear equation of state.</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="stringliteral">        Differentiating the linear equation of state with respect to temperature, and assuming \f$ \beta_{S} \f$ equals zero, gives</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="stringliteral">        \f[</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="stringliteral">        \frac{\partial \rho}{\partial t} = - \rho_{nil} \alpha_{T} \frac{\partial \theta}{\partial t}</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="stringliteral">        \f]</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        <span class="keywordflow">if</span> model_instance[<span class="stringliteral">&#39;EOS_type&#39;</span>] == <span class="stringliteral">&#39;linear&#39;</span>:</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;            <span class="keywordflow">if</span> self[<span class="stringliteral">&#39;Sbeta&#39;</span>] == 0:</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                self[<span class="stringliteral">&#39;TotRhoTend&#39;</span>] = (-self[<span class="stringliteral">&#39;RhoNil&#39;</span>]*self[<span class="stringliteral">&#39;Talpha&#39;</span>]*model_instance.temperature[<span class="stringliteral">&#39;TOTTTEND&#39;</span>])</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;                <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;This operator only supports temperature variations at the moment. Sorry.&#39;</span>) </div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        <span class="keywordflow">else</span>:    </div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;            <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Only liner EOS supported at the moment.&#39;</span>)</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;            </div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    </div>
<div class="line"><a name="l00867"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_bernoulli.html">  867</a></span>&#160;<span class="keyword">class </span><a class="code" href="classmitgcm_1_1core_1_1_bernoulli.html">Bernoulli</a>(<a class="code" href="classmitgcm_1_1core_1_1_tracerpoint__field.html">Tracerpoint_field</a>):</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!The Bernoulli field, evaluated from velocity, Pressure and Density.</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;<span class="stringliteral">    \f[</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="stringliteral">    BP = \frac{P}{\rho_{0}} +  g z + \frac{u^{2} + v^{2}}{2}</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="stringliteral">    \f]</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00873"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_bernoulli.html#a823e52977dd3ac349fb569eb3a4bf167">  873</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_bernoulli.html#a823e52977dd3ac349fb569eb3a4bf167">__init__</a>(self,model_instance,density_field=&#39;RHO&#39;,UVEL_field=&#39;UVEL&#39;,VVEL_field=&#39;VVEL&#39;):</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        BP_pressure = ((model_instance.pressure[<span class="stringliteral">&#39;P&#39;</span>][:,:,:]/model_instance.density[<span class="stringliteral">&#39;RhoNil&#39;</span>] + </div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;                 model_instance.grid[<span class="stringliteral">&#39;Z&#39;</span>][:].reshape((len(model_instance.grid[<span class="stringliteral">&#39;Z&#39;</span>][:]),1,1))*model_instance[<span class="stringliteral">&#39;g&#39;</span>]))</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;        BP_u = (model_instance.zonal_velocity[UVEL_field][:,:,1:]*model_instance.zonal_velocity[UVEL_field][:,:,1:] + </div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                 model_instance.zonal_velocity[UVEL_field][:,:,:-1]*model_instance.zonal_velocity[UVEL_field][:,:,:-1])/2</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        BP_v = (model_instance.meridional_velocity[VVEL_field][:,1:,:]*model_instance.meridional_velocity[VVEL_field][:,1:,:] + </div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                 model_instance.meridional_velocity[VVEL_field][:,:-1,:]*model_instance.meridional_velocity[VVEL_field][:,:-1,:])/2</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        self[<span class="stringliteral">&#39;BP&#39;</span>] = model_instance.grid[<span class="stringliteral">&#39;wet_mask_TH&#39;</span>][:]*(BP_pressure + (BP_u + BP_v)/2)</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;        <span class="comment"># decomposition into three components suggested by Craig.</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        </div>
<div class="line"><a name="l00886"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_pressure.html">  886</a></span>&#160;<span class="keyword">class </span><a class="code" href="classmitgcm_1_1core_1_1_pressure.html">Pressure</a>(<a class="code" href="classmitgcm_1_1core_1_1_tracerpoint__field.html">Tracerpoint_field</a>):</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Calculates the pressure field from the density field using the hydrostatic approximation.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00888"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_pressure.html#a015248e433a994b90e08ec3123687ec8">  888</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_pressure.html#a015248e433a994b90e08ec3123687ec8">__init__</a>(self,model_instance,density_field=&#39;RHO&#39;,ETAN_field=&#39;ETAN&#39;):</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        <span class="comment"># derive the hydrostatic pressure</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        delta_P = np.zeros((np.shape(model_instance.density[density_field])))</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        delta_P[:,:,:] = (model_instance[<span class="stringliteral">&#39;g&#39;</span>]*model_instance.density[density_field][:,:,:]*</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;                            model_instance.grid[<span class="stringliteral">&#39;drF&#39;</span>][:].reshape(len(model_instance.grid[<span class="stringliteral">&#39;drF&#39;</span>][:]),1,1))</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;        </div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    </div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;        <span class="comment"># add free surface contribution</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        delta_P[0,:,:] = (delta_P[0,:,:] + </div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;                          model_instance.free_surface[ETAN_field]*model_instance[<span class="stringliteral">&#39;g&#39;</span>]*model_instance.density[density_field][0,:,:])</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    </div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        self[<span class="stringliteral">&#39;delta_P&#39;</span>] = delta_P</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        self[<span class="stringliteral">&#39;P&#39;</span>] = np.cumsum(delta_P,0)</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        </div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        <span class="keywordflow">return</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    </div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        </div>
<div class="line"><a name="l00907"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_potential__vorticity.html">  907</a></span>&#160;<span class="keyword">class </span><a class="code" href="classmitgcm_1_1core_1_1_potential__vorticity.html">Potential_vorticity</a>(<a class="code" href="classmitgcm_1_1core_1_1_tracerpoint__field.html">Tracerpoint_field</a>):</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Evaluate the potential vorticity on the tracer points.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00909"></a><span class="lineno"><a class="line" href="classmitgcm_1_1core_1_1_potential__vorticity.html#aa5cd85f4c534241e18601d592c30b098">  909</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmitgcm_1_1core_1_1_potential__vorticity.html#aa5cd85f4c534241e18601d592c30b098">__init__</a>(self,model_instance,density_field=&#39;RhoNil&#39;,density_deriv_field=&#39;dRHO_dz&#39;,vort_field=&#39;omega_a&#39;):</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        self[<span class="stringliteral">&#39;Q&#39;</span>] = -model_instance.vorticity[vort_field]*model_instance.density[density_deriv_field]/model_instance.density[density_field]</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        </div>
<div class="line"><a name="l00913"></a><span class="lineno"><a class="line" href="namespacemitgcm_1_1core.html#a27a0189528ab26e550791d3f0d85142c">  913</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacemitgcm_1_1core.html#a27a0189528ab26e550791d3f0d85142c">show_variables</a>(netcdf_filename):</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!A shortcut function to display all of the variables contained within a netcdf file.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    netcdf_file = netCDF4.Dataset(netcdf_filename)</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <span class="keywordflow">print</span> netcdf_file.variables.keys()</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    netcdf_file.close()</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  </div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  </div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="keyword">def </span><a class="code" href="namespacemitgcm_1_1core.html#a84cb1c1515c236e37c08e6b3e413e313">plt_mon_stats</a>(netcdf_filename,</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                    variables=[<span class="stringliteral">&#39;advcfl_uvel_max&#39;</span>,<span class="stringliteral">&#39;advcfl_vvel_max&#39;</span>,<span class="stringliteral">&#39;advcfl_wvel_max&#39;</span>],</div>
<div class="line"><a name="l00924"></a><span class="lineno"><a class="line" href="namespacemitgcm_1_1core.html#a84cb1c1515c236e37c08e6b3e413e313">  924</a></span>&#160;                    time_units=<span class="stringliteral">&#39;days&#39;</span>):</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Plot some monitor file variables. </span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="stringliteral">    Options include:</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="stringliteral">    * advcfl_uvel_max</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="stringliteral">    * advcfl_vvel_max</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="stringliteral">    * advcfl_wvel_max</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="stringliteral">    * ke_mean</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="stringliteral">    * dynstat_theta_mean</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="stringliteral">    * dynstat_sst_mean</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="stringliteral">    * dynstat_sst_sd</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="stringliteral">    * dynstat_salt_max</span></div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;<span class="stringliteral">    * dynstat_salt_min</span></div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;<span class="stringliteral">    * dynstat_uvel_mean</span></div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="stringliteral">    * dynstat_vvel_mean</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="stringliteral">    * dynstat_wvel_mean</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="stringliteral">    * ...</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="stringliteral">    * and many others.</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    monitor_output = netCDF4.MFDataset(netcdf_filename)</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    </div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <span class="keywordflow">if</span> time_units == <span class="stringliteral">&#39;days&#39;</span>:</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        time = monitor_output.variables[<span class="stringliteral">&#39;time_secondsf&#39;</span>][:]/(86400)</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    <span class="keywordflow">elif</span> time_units == <span class="stringliteral">&#39;years&#39;</span>:</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        time = monitor_output.variables[<span class="stringliteral">&#39;time_secondsf&#39;</span>][:]/(86400*365)</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        <span class="keywordflow">raise</span> ValueError(str(time_units) + <span class="stringliteral">&#39; is not a valid option for time_units&#39;</span>)</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    <span class="keywordflow">for</span> stat <span class="keywordflow">in</span> variables:</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        plt.plot(time,monitor_output.variables[stat][:],label=stat)</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    plt.xlabel(<span class="stringliteral">&#39;Model &#39;</span>+ time_units)</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    plt.legend()</div>
<div class="ttc" id="classmitgcm_1_1core_1_1_m_i_tgcm___simulation_html_a2a8e8df1221028288883837cbf027bdb"><div class="ttname"><a href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html#a2a8e8df1221028288883837cbf027bdb">mitgcm.core.MITgcm_Simulation.__div__</a></div><div class="ttdeci">def __div__(self, other)</div><div class="ttdoc">A method that allows model objects to be divided by floating point numbers. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00070">core.py:70</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_vorticitypoint__field_html_a1ac62e67431f0edfedfec642f3f5d3f3"><div class="ttname"><a href="classmitgcm_1_1core_1_1_vorticitypoint__field.html#a1ac62e67431f0edfedfec642f3f5d3f3">mitgcm.core.Vorticitypoint_field.take_d_dy</a></div><div class="ttdeci">def take_d_dy</div><div class="ttdoc">Take the y derivative of the field given on vorticity-points, using the spacings in grid object...</div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00599">core.py:599</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_pressure_html"><div class="ttname"><a href="classmitgcm_1_1core_1_1_pressure.html">mitgcm.core.Pressure</a></div><div class="ttdoc">Calculates the pressure field from the density field using the hydrostatic approximation. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00886">core.py:886</a></div></div>
<div class="ttc" id="namespacemitgcm_1_1core_html_a27a0189528ab26e550791d3f0d85142c"><div class="ttname"><a href="namespacemitgcm_1_1core.html#a27a0189528ab26e550791d3f0d85142c">mitgcm.core.show_variables</a></div><div class="ttdeci">def show_variables(netcdf_filename)</div><div class="ttdoc">A shortcut function to display all of the variables contained within a netcdf file. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00913">core.py:913</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_wpoint__field_html_a3dae400759f1828507a317507dbf681b"><div class="ttname"><a href="classmitgcm_1_1core_1_1_wpoint__field.html#a3dae400759f1828507a317507dbf681b">mitgcm.core.Wpoint_field.take_d_dx</a></div><div class="ttdeci">def take_d_dx</div><div class="ttdoc">Take the x derivative of the field on w points, using spacings in grid object. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00346">core.py:346</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_m_i_tgcm___simulation_html_a975760ba1406c74ad06af11ca3925397"><div class="ttname"><a href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html#a975760ba1406c74ad06af11ca3925397">mitgcm.core.MITgcm_Simulation.load_field</a></div><div class="ttdeci">def load_field</div><div class="ttdoc">Load a model field from NetCDF output. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00037">core.py:37</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_m_i_tgcm___simulation_html"><div class="ttname"><a href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html">mitgcm.core.MITgcm_Simulation</a></div><div class="ttdoc">The simulation class is the main class of this package, and an instance of this class is a model obje...</div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00018">core.py:18</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_pressure_html_a015248e433a994b90e08ec3123687ec8"><div class="ttname"><a href="classmitgcm_1_1core_1_1_pressure.html#a015248e433a994b90e08ec3123687ec8">mitgcm.core.Pressure.__init__</a></div><div class="ttdeci">def __init__</div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00888">core.py:888</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_tracerpoint__field_html_aa7104af7db145561e258c97c96c1be1b"><div class="ttname"><a href="classmitgcm_1_1core_1_1_tracerpoint__field.html#aa7104af7db145561e258c97c96c1be1b">mitgcm.core.Tracerpoint_field.numerics_take_d_dy</a></div><div class="ttdeci">def numerics_take_d_dy(self, rho, wet_mask_TH, dyC)</div><div class="ttdoc">The numerical bit of taking the y derivative. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00505">core.py:505</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_bernoulli_html"><div class="ttname"><a href="classmitgcm_1_1core_1_1_bernoulli.html">mitgcm.core.Bernoulli</a></div><div class="ttdoc">The Bernoulli field, evaluated from velocity, Pressure and Density. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00867">core.py:867</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_wpoint__field_html_abc10b27c7fc6fd59b2e525485242d4c1"><div class="ttname"><a href="classmitgcm_1_1core_1_1_wpoint__field.html#abc10b27c7fc6fd59b2e525485242d4c1">mitgcm.core.Wpoint_field.load_field</a></div><div class="ttdeci">def load_field</div><div class="ttdoc">Load a model field from NetCDF output. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00321">core.py:321</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_upoint__field_html_a40c4ea3c2527688e8419c0a276e27d5c"><div class="ttname"><a href="classmitgcm_1_1core_1_1_upoint__field.html#a40c4ea3c2527688e8419c0a276e27d5c">mitgcm.core.Upoint_field.take_d_dx</a></div><div class="ttdeci">def take_d_dx</div><div class="ttdoc">Derivatives of model fields. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00103">core.py:103</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_wpoint__field_html_a3874bb9811b39ed61b25de3ba3e3c39c"><div class="ttname"><a href="classmitgcm_1_1core_1_1_wpoint__field.html#a3874bb9811b39ed61b25de3ba3e3c39c">mitgcm.core.Wpoint_field.take_d_dy</a></div><div class="ttdeci">def take_d_dy</div><div class="ttdoc">Take the y derivative of the field on w points, using spacings in grid object. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00378">core.py:378</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_upoint__field_html_ab4adbcfd61c7b303b8499a5228cd6f77"><div class="ttname"><a href="classmitgcm_1_1core_1_1_upoint__field.html#ab4adbcfd61c7b303b8499a5228cd6f77">mitgcm.core.Upoint_field.__init__</a></div><div class="ttdeci">def __init__</div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00094">core.py:94</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_grid_html"><div class="ttname"><a href="classmitgcm_1_1core_1_1_grid.html">mitgcm.core.Grid</a></div><div class="ttdoc">This defines the class for the grid object. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00659">core.py:659</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_vpoint__field_html"><div class="ttname"><a href="classmitgcm_1_1core_1_1_vpoint__field.html">mitgcm.core.Vpoint_field</a></div><div class="ttdoc">This is the class for all fields on meridional velocity points. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00205">core.py:205</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_upoint__field_html_acac1cef0245cd27c0975a84bef22a71d"><div class="ttname"><a href="classmitgcm_1_1core_1_1_upoint__field.html#acac1cef0245cd27c0975a84bef22a71d">mitgcm.core.Upoint_field.take_d_dy</a></div><div class="ttdeci">def take_d_dy</div><div class="ttdoc">Take the y derivative of the field on u points, using the spacings provided. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00137">core.py:137</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_density_html"><div class="ttname"><a href="classmitgcm_1_1core_1_1_density.html">mitgcm.core.Density</a></div><div class="ttdoc">A tracer point field that contains methods for density fields. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00810">core.py:810</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_vorticitypoint__field_html_ad66ee0e21b3b64b6263d322c7d28a0d1"><div class="ttname"><a href="classmitgcm_1_1core_1_1_vorticitypoint__field.html#ad66ee0e21b3b64b6263d322c7d28a0d1">mitgcm.core.Vorticitypoint_field.__init__</a></div><div class="ttdeci">def __init__</div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00559">core.py:559</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_tracerpoint__field_html_abdbf0d953baced17806d26ed4fedad12"><div class="ttname"><a href="classmitgcm_1_1core_1_1_tracerpoint__field.html#abdbf0d953baced17806d26ed4fedad12">mitgcm.core.Tracerpoint_field.numerics_take_d_dx</a></div><div class="ttdeci">def numerics_take_d_dx(self, rho, wet_mask_TH, dxC)</div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00469">core.py:469</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_tracerpoint__field_html_a4e5ca6800530f2c8da4bc3d21ef4e50d"><div class="ttname"><a href="classmitgcm_1_1core_1_1_tracerpoint__field.html#a4e5ca6800530f2c8da4bc3d21ef4e50d">mitgcm.core.Tracerpoint_field.take_d_dx</a></div><div class="ttdeci">def take_d_dx</div><div class="ttdoc">Take the x derivative of the field on tracer points, using spacings in grid object. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00451">core.py:451</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_vpoint__field_html_a9975d2dcfb23b8cca0986f7e469882fa"><div class="ttname"><a href="classmitgcm_1_1core_1_1_vpoint__field.html#a9975d2dcfb23b8cca0986f7e469882fa">mitgcm.core.Vpoint_field.take_d_dz</a></div><div class="ttdeci">def take_d_dz</div><div class="ttdoc">Take the z derivative of the field given on v-points, using the spacings in grid object. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00281">core.py:281</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_vpoint__field_html_a0077d0cdd01de210b130f1e684d61b6d"><div class="ttname"><a href="classmitgcm_1_1core_1_1_vpoint__field.html#a0077d0cdd01de210b130f1e684d61b6d">mitgcm.core.Vpoint_field.take_d_dx</a></div><div class="ttdeci">def take_d_dx</div><div class="ttdoc">Take the x derivative of the field on v points using the spacings in model_instance.grid object. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00218">core.py:218</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_bernoulli_html_a823e52977dd3ac349fb569eb3a4bf167"><div class="ttname"><a href="classmitgcm_1_1core_1_1_bernoulli.html#a823e52977dd3ac349fb569eb3a4bf167">mitgcm.core.Bernoulli.__init__</a></div><div class="ttdeci">def __init__</div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00873">core.py:873</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_wpoint__field_html"><div class="ttname"><a href="classmitgcm_1_1core_1_1_wpoint__field.html">mitgcm.core.Wpoint_field</a></div><div class="ttdoc">This is the class for all fields on vertical velocity points. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00310">core.py:310</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_upoint__field_html_acbc550b512401054ac04eca3dc7318af"><div class="ttname"><a href="classmitgcm_1_1core_1_1_upoint__field.html#acbc550b512401054ac04eca3dc7318af">mitgcm.core.Upoint_field.take_d_dz</a></div><div class="ttdeci">def take_d_dz</div><div class="ttdoc">Take the z derivative of the field given on u-points, using the spacings in grid object. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00176">core.py:176</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_potential__vorticity_html_aa5cd85f4c534241e18601d592c30b098"><div class="ttname"><a href="classmitgcm_1_1core_1_1_potential__vorticity.html#aa5cd85f4c534241e18601d592c30b098">mitgcm.core.Potential_vorticity.__init__</a></div><div class="ttdeci">def __init__</div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00909">core.py:909</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_m_i_tgcm___simulation_html_aa18b056e051289d148f1493f1aa75b55"><div class="ttname"><a href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html#aa18b056e051289d148f1493f1aa75b55">mitgcm.core.MITgcm_Simulation.__mul__</a></div><div class="ttdeci">def __mul__(self, other)</div><div class="ttdoc">A method that allows model objects to be multiplied by floating point numbers. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00077">core.py:77</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_density_html_ac4f90f6a9c4a9fe9608b5bfdcb09a47c"><div class="ttname"><a href="classmitgcm_1_1core_1_1_density.html#ac4f90f6a9c4a9fe9608b5bfdcb09a47c">mitgcm.core.Density.__init__</a></div><div class="ttdeci">def __init__</div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00823">core.py:823</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_m_i_tgcm___simulation_html_a984db65a189bf843e988079f724cdee3"><div class="ttname"><a href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html#a984db65a189bf843e988079f724cdee3">mitgcm.core.MITgcm_Simulation.grid</a></div><div class="ttdeci">grid</div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00028">core.py:28</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_tracerpoint__field_html_aa54bc7f1fe31f946b3ed13cc1c66f22e"><div class="ttname"><a href="classmitgcm_1_1core_1_1_tracerpoint__field.html#aa54bc7f1fe31f946b3ed13cc1c66f22e">mitgcm.core.Tracerpoint_field.take_d_dz</a></div><div class="ttdeci">def take_d_dz</div><div class="ttdoc">Take the z derivative of the field given on tracer-points, using the spacings in grid object...</div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00526">core.py:526</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_m_i_tgcm___simulation_html_aac012c75a0f5dce8bbc4b00422a12444"><div class="ttname"><a href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html#aac012c75a0f5dce8bbc4b00422a12444">mitgcm.core.MITgcm_Simulation.__init__</a></div><div class="ttdeci">def __init__</div><div class="ttdoc">Instantiate an MITgcm model instance. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00022">core.py:22</a></div></div>
<div class="ttc" id="namespacemitgcm_1_1core_html_a84cb1c1515c236e37c08e6b3e413e313"><div class="ttname"><a href="namespacemitgcm_1_1core.html#a84cb1c1515c236e37c08e6b3e413e313">mitgcm.core.plt_mon_stats</a></div><div class="ttdeci">def plt_mon_stats</div><div class="ttdoc">Plot some monitor file variables. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00924">core.py:924</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_tracerpoint__field_html_a5292f8f5c2110f476329806bee9315bf"><div class="ttname"><a href="classmitgcm_1_1core_1_1_tracerpoint__field.html#a5292f8f5c2110f476329806bee9315bf">mitgcm.core.Tracerpoint_field.take_d_dy</a></div><div class="ttdeci">def take_d_dy</div><div class="ttdoc">Take the y derivative of the field on tracer points, using spacings in grid object. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00489">core.py:489</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_tracerpoint__field_html"><div class="ttname"><a href="classmitgcm_1_1core_1_1_tracerpoint__field.html">mitgcm.core.Tracerpoint_field</a></div><div class="ttdoc">This is the base class for all model fields on the tracer points. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00442">core.py:442</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_grid_html_ad33f3e78699330079c7ae7dfbd5d7adb"><div class="ttname"><a href="classmitgcm_1_1core_1_1_grid.html#ad33f3e78699330079c7ae7dfbd5d7adb">mitgcm.core.Grid.compute_masks</a></div><div class="ttdeci">def compute_masks(self, wet_mask_TH)</div><div class="ttdoc">This function does the compuationally heavy job of looping through each dimension and creating masks ...</div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00765">core.py:765</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_vpoint__field_html_a1ffd906684a51a4045b0b02092fab5ec"><div class="ttname"><a href="classmitgcm_1_1core_1_1_vpoint__field.html#a1ffd906684a51a4045b0b02092fab5ec">mitgcm.core.Vpoint_field.__init__</a></div><div class="ttdeci">def __init__</div><div class="ttdoc">Instantiate a field on the meridional velocity points. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00208">core.py:208</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_grid_html_a79af97fd15b63db33ac352236168d38b"><div class="ttname"><a href="classmitgcm_1_1core_1_1_grid.html#a79af97fd15b63db33ac352236168d38b">mitgcm.core.Grid.__init__</a></div><div class="ttdeci">def __init__(self, grid_netcdf_filename)</div><div class="ttdoc">Define a single object that has all of the grid variables tucked away in it. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00665">core.py:665</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_potential__vorticity_html"><div class="ttname"><a href="classmitgcm_1_1core_1_1_potential__vorticity.html">mitgcm.core.Potential_vorticity</a></div><div class="ttdoc">Evaluate the potential vorticity on the tracer points. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00907">core.py:907</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_density_html_ace1f408672554eb3871856cb8934aaa0"><div class="ttname"><a href="classmitgcm_1_1core_1_1_density.html#ace1f408672554eb3871856cb8934aaa0">mitgcm.core.Density.calculate_TotRhoTend</a></div><div class="ttdeci">def calculate_TotRhoTend(self, model_instance)</div><div class="ttdoc">Calculate time rate of change of the Density field from the temperature tendency and the linear equat...</div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00849">core.py:849</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_wpoint__field_html_a3f7ffb2f1ed512712805bf78d8a8cde4"><div class="ttname"><a href="classmitgcm_1_1core_1_1_wpoint__field.html#a3f7ffb2f1ed512712805bf78d8a8cde4">mitgcm.core.Wpoint_field.take_d_dz</a></div><div class="ttdeci">def take_d_dz</div><div class="ttdoc">Take the z derivative of the field given on w-points, using the spacings in grid object. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00409">core.py:409</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_density_html_a2218bb1f82fd92d2d828bc30a87b69f3"><div class="ttname"><a href="classmitgcm_1_1core_1_1_density.html#a2218bb1f82fd92d2d828bc30a87b69f3">mitgcm.core.Density.calculate_density</a></div><div class="ttdeci">def calculate_density</div><div class="ttdoc">Cacluate Density field given temperature and salinity fields, using the linear equation of state...</div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00836">core.py:836</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_tracerpoint__field_html_a71960ccda494c5844ef01526a32bed1e"><div class="ttname"><a href="classmitgcm_1_1core_1_1_tracerpoint__field.html#a71960ccda494c5844ef01526a32bed1e">mitgcm.core.Tracerpoint_field.__init__</a></div><div class="ttdeci">def __init__</div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00444">core.py:444</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_m_i_tgcm___simulation_html_a029086ad72acb8cb8c12e9d02e0092aa"><div class="ttname"><a href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html#a029086ad72acb8cb8c12e9d02e0092aa">mitgcm.core.MITgcm_Simulation.__rmul__</a></div><div class="ttdeci">def __rmul__(self, other)</div><div class="ttdoc">A method that allows model objects to be multiplied by floating point numbers. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00084">core.py:84</a></div></div>
<div class="ttc" id="classdict_html"><div class="ttname"><a href="classdict.html">dict</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_upoint__field_html"><div class="ttname"><a href="classmitgcm_1_1core_1_1_upoint__field.html">mitgcm.core.Upoint_field</a></div><div class="ttdoc">This is the class for all fields on zonal velocity points. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00091">core.py:91</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_vorticitypoint__field_html_a2819c9078fdedaea17990850de8659fb"><div class="ttname"><a href="classmitgcm_1_1core_1_1_vorticitypoint__field.html#a2819c9078fdedaea17990850de8659fb">mitgcm.core.Vorticitypoint_field.take_d_dz</a></div><div class="ttdeci">def take_d_dz</div><div class="ttdoc">Take the z derivative of the field given on vorticity-points, using the spacings in grid object...</div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00629">core.py:629</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_vpoint__field_html_a7ffa6c1b239c78422f0224d675fd785e"><div class="ttname"><a href="classmitgcm_1_1core_1_1_vpoint__field.html#a7ffa6c1b239c78422f0224d675fd785e">mitgcm.core.Vpoint_field.take_d_dy</a></div><div class="ttdeci">def take_d_dy</div><div class="ttdoc">Take the y derivative of the field given on v-points, using the spacings in grid object. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00250">core.py:250</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_vorticitypoint__field_html"><div class="ttname"><a href="classmitgcm_1_1core_1_1_vorticitypoint__field.html">mitgcm.core.Vorticitypoint_field</a></div><div class="ttdoc">A class for fields on vorticity points. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00557">core.py:557</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_vorticitypoint__field_html_ab7dd01f831fe81a7ce431625d54aa11f"><div class="ttname"><a href="classmitgcm_1_1core_1_1_vorticitypoint__field.html#ab7dd01f831fe81a7ce431625d54aa11f">mitgcm.core.Vorticitypoint_field.take_d_dx</a></div><div class="ttdeci">def take_d_dx</div><div class="ttdoc">Take the x derivative of the field given on vorticity-points, using the spacings in grid object...</div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00568">core.py:568</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_wpoint__field_html_a5149dd8a1c832999bdbcd60b4abc3b14"><div class="ttname"><a href="classmitgcm_1_1core_1_1_wpoint__field.html#a5149dd8a1c832999bdbcd60b4abc3b14">mitgcm.core.Wpoint_field.__init__</a></div><div class="ttdeci">def __init__</div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00313">core.py:313</a></div></div>
<div class="ttc" id="classmitgcm_1_1core_1_1_m_i_tgcm___simulation_html_ad87c2a60ef71c33a8a8bcbb7b7f8564b"><div class="ttname"><a href="classmitgcm_1_1core_1_1_m_i_tgcm___simulation.html#ad87c2a60ef71c33a8a8bcbb7b7f8564b">mitgcm.core.MITgcm_Simulation.__add__</a></div><div class="ttdeci">def __add__(self, other)</div><div class="ttdoc">A method that allows model objects to be added together. </div><div class="ttdef"><b>Definition:</b> <a href="core_8py_source.html#l00061">core.py:61</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Mar 6 2015 16:07:13 for mitgcm by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
